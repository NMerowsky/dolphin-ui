# see http://about.travis-ci.org/docs/user/languages/php/ for more hints
language: php

# list any PHP version you want to test against
php:
  # using major version aliases
  # aliased to 5.2.17
  - 5.2
  # aliased to 5.3.29
  - 5.3
  # aliased to a recent 5.4.x version
  - 5.4
  # aliased to a recent 5.5.x version
  - 5.5
  # aliased to a recent 5.6.x version
  - 5.6
  # aliased to a recent hhvm version
  - hhvm

env:
  - mysql

services:
  - mysql

before_script:
  - sudo apt-get update
  - sudo apt-get install apache2 libapache2-mod-fastcgi
  # enable php-fpm
  - sudo ls ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d
  - sudo cat ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - cp ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf
  - a2enmod rewrite actions fastcgi alias
  - echo "cgi.fix_pathinfo = 1" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - ~/.phpenv/versions/$(phpenv version-name)/sbin/php-fpm
  # configure apache virtual hosts
  - cp -f build/travis-ci-apache /etc/apache2/sites-available/default
  - sed -e "s?%TRAVIS_BUILD_DIR%?$(pwd)?g" --in-place /etc/apache2/sites-available/default
  - service apache2 restart
  # update database
  - gzip -d db/biocoredb.sql.gz
  - mysql < db/biocoredb.sql
  - mysql < db/2015_07_22_consolidated_1.sql
  - mysql < db/2015_08_31_wkeylist.sql
  - mysql < db/2015_10_16_ngs_createtables.sql
  - mysql < db/2015_10_27_tablegen_sidebar.sql
  - mysql -e "CREATE USER 'bioinfo'@'localhost' IDENTIFIED BY 'bioinfo2013'; GRANT ALL ON *.* TO 'bioinfo'@'localhost';" -uroot

script: phpunit unitTesting/ngsimport_unittest.php
